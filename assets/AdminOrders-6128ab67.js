import{S as h}from"./sweetalert2.all-5cbc8e75.js";import{M as w,P as D,D as T}from"./DeleteModal-82f3b36d.js";import{_ as y,o,c as d,a as e,t as r,f as b,F as _,e as g,h as M,m as k,r as p,d as V,b as m,i as E}from"./index-9f380a15.js";const B={props:{order:{type:Object,default(){return{}}}},data(){return{status:{},orderModal:null,tempOrder:{},isPaid:!1}},emits:["update-order","date"],watch:{order(){this.tempOrder=this.order}},methods:{openModal(){this.orderModal.show()},hideModal(){this.orderModal.hide()},date(l){const s=new Date(l*1e3);return`${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()}`}},mounted(){this.orderModal=new w(this.$refs.orderModal)}},L={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},A={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},S=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},I={class:"row"},N={class:"col-md-4"},R=e("h3",null,"用戶資料",-1),z={class:"table"},F={key:0},j=e("th",{style:{width:"100px"}},"姓名",-1),q=e("th",null,"Email",-1),H=e("th",null,"電話",-1),W=e("th",null,"地址",-1),Y={class:"col-md-8"},G=e("h3",null,"訂單細節",-1),J={class:"table"},Q=e("th",{style:{width:"100px"}},"訂單編號",-1),X=e("th",null,"下單時間",-1),Z=e("th",null,"付款時間",-1),ee={key:0},te={key:1},se=e("th",null,"付款狀態",-1),oe={key:0,class:"text-success"},de={key:1,class:"text-muted"},le=e("th",null,"總金額",-1),re=e("h3",null,"選購商品",-1),ne={class:"table"},ae=e("thead",null,[e("tr")],-1),ie={class:"text-end"},ce={class:"d-flex justify-content-end"},ue={class:"form-check"},he={class:"form-check-label",for:"flexCheckDefault"},_e={key:0},pe={key:1},me={class:"modal-footer"},fe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Oe(l,s,u,x,t,a){return o(),d("div",L,[e("div",A,[e("div",U,[S,e("div",K,[e("div",I,[e("div",N,[R,e("table",z,[t.tempOrder.user?(o(),d("tbody",F,[e("tr",null,[j,e("td",null,r(t.tempOrder.user.name),1)]),e("tr",null,[q,e("td",null,r(t.tempOrder.user.email),1)]),e("tr",null,[H,e("td",null,r(t.tempOrder.user.tel),1)]),e("tr",null,[W,e("td",null,r(t.tempOrder.user.address),1)])])):b("",!0)])]),e("div",Y,[G,e("table",J,[e("tbody",null,[e("tr",null,[Q,e("td",null,r(t.tempOrder.id),1)]),e("tr",null,[X,e("td",null,r(a.date(t.tempOrder.create_at)),1)]),e("tr",null,[Z,e("td",null,[t.tempOrder.paid_date?(o(),d("span",ee,r(a.date(t.tempOrder.paid_date)),1)):(o(),d("span",te,"時間不正確"))])]),e("tr",null,[se,e("td",null,[t.tempOrder.is_paid?(o(),d("strong",oe,"已付款")):(o(),d("span",de,"尚未付款"))])]),e("tr",null,[le,e("td",null,r(t.tempOrder.total),1)])])]),re,e("table",ne,[ae,e("tbody",null,[(o(!0),d(_,null,g(t.tempOrder.products,i=>(o(),d("tr",{key:i.id},[e("th",null,r(i.product.title),1),e("td",null,r(i.qty)+" / "+r(i.product.unit),1),e("td",ie,r(i.final_total),1)]))),128))])]),e("div",ce,[e("div",ue,[M(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":s[0]||(s[0]=i=>t.tempOrder.is_paid=i)},null,512),[[k,t.tempOrder.is_paid]]),e("label",he,[t.tempOrder.is_paid?(o(),d("span",_e,"已付款")):(o(),d("span",pe,"未付款"))])])])])])]),e("div",me,[fe,e("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=i=>l.$emit("update-order",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const be=y(B,[["render",Oe]]),{VITE_APP_URL:f,VITE_APP_PATH:O}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"zxcv123",BASE_URL:"/Vue3_Week7/",MODE:"production",DEV:!1,PROD:!0},ge={data(){return{orders:[],tempOrder:{},page:{},currentPage:1,isOrder:!1}},methods:{getOrders(l=1){this.currentPage=l;const s=this.$loading.show({container:this.fullPage?null:this.$refs.formContainer,canCancel:!1,onCancel:this.onCancel,loader:"dots",width:100,height:100,color:"gray"});this.$http.get(`${f}v2/api/${O}/admin/orders?page=${l}`).then(u=>{this.orders=u.data.orders,this.page=u.data.pagination,s.hide()}).catch(u=>{h.fire({title:u.response.data.message,icon:"error",confirmButtonText:"OK"}),s.hide()})},openModal(l,s){l==="edit"?(this.$refs.orderModal.openModal(),this.tempOrder={...s}):l==="deleteOrder"&&(this.$refs.delProductModal.opendelModal(),this.tempOrder={...s},this.isOrder=!0)},deleteOrder(){this.$http.delete(`${f}v2/api/${O}/admin/order/${this.tempOrder.id}`).then(l=>{h.fire({title:l.data.message,icon:"success",confirmButtonText:"OK"}),this.getOrders(this.currentPage),this.$refs.delProductModal.hidedelModal()}).catch(l=>{h.fire({title:l.response.data.message,icon:"error",confirmButtonText:"OK"})})},updateOrder(l){this.tempOrder=l,this.tempOrder.is_paid?this.tempOrder.paid_date=Math.round(new Date().getTime()/1e3):this.tempOrder.is_paid||(this.tempOrder.paid_date=""),this.$http.put(`${f}v2/api/${O}/admin/order/${this.tempOrder.id}`,{data:this.tempOrder}).then(s=>{h.fire({title:s.data.message,icon:"success",confirmButtonText:"OK"}),this.getOrders(this.currentPage),this.$refs.orderModal.hideModal()}).catch(s=>{h.fire({title:s.response.data.message,icon:"error",confirmButtonText:"OK"})})},date(l){return new Date(l*1e3).toLocaleDateString()}},mounted(){this.getOrders()},components:{PaginationComponent:D,DeleteModal:T,OrderModal:be}},ye={class:"table mt-4"},Me=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),ke=["textContent"],xe={class:"list-unstyled"},ve={class:"text-right"},Pe={class:"form-check form-switch"},Ce=["id","onUpdate:modelValue","onChange"],$e=["for"],we={key:0},De={key:1},Te={class:"btn-group"},Ve=["onClick"],Ee=["onClick"];function Be(l,s,u,x,t,a){const i=p("Loading"),v=p("OrderModal"),P=p("DeleteModal"),C=p("PaginationComponent");return o(),d(_,null,[V(" 這是後台訂單列表 "),m(i,{"z-index":1060}),e("table",ye,[Me,e("tbody",null,[(o(!0),d(_,null,g(t.orders,n=>(o(),d(_,{key:n.id},[t.orders.length?(o(),d("tr",{key:0,class:E({"text-secondary":!n.is_paid})},[e("td",null,r(a.date(n.create_at)),1),e("td",null,[n.user?(o(),d("span",{key:0,textContent:r(n.user.email)},null,8,ke)):b("",!0)]),e("td",null,[e("ul",xe,[(o(!0),d(_,null,g(n.products,(c,$)=>(o(),d("li",{key:$},r(c.product.title)+" 數量："+r(c.qty)+" "+r(c.product.unit),1))),128))])]),e("td",ve,r(n.total),1),e("td",null,[e("div",Pe,[M(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${n.id}`,"onUpdate:modelValue":c=>n.is_paid=c,onChange:c=>a.updateOrder(n)},null,40,Ce),[[k,n.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${n.id}`},[n.is_paid?(o(),d("span",we,"已付款")):(o(),d("span",De,"未付款"))],8,$e)])]),e("td",null,[e("div",Te,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>a.openModal("edit",n)}," 檢視 ",8,Ve),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>a.openModal("deleteOrder",n)}," 刪除 ",8,Ee)])])],2)):b("",!0)],64))),128))])]),m(v,{ref:"orderModal",order:t.tempOrder,onUpdateOrder:a.updateOrder},null,8,["order","onUpdateOrder"]),m(P,{ref:"delProductModal","temp-product":t.tempOrder,"delete-product":a.deleteOrder,"is-order":t.isOrder,"temp-order":t.tempOrder},null,8,["temp-product","delete-product","is-order","temp-order"]),m(C,{pages:t.page,"get-data":a.getOrders},null,8,["pages","get-data"])],64)}const Se=y(ge,[["render",Be]]);export{Se as default};
